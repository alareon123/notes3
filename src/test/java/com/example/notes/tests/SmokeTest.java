package com.example.notes.tests;

import com.example.notes.core.BaseApiTest;
import com.example.notes.endpoints.NotesClient;
import io.restassured.response.Response;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import static org.hamcrest.Matchers.equalTo;

/**
 * SMOKE-ТЕСТЫ (Дымовые тесты)
 *
 * Что такое Smoke-тест?
 * Это самый базовый тест, который проверяет "дышит ли приложение".
 * Название взято из электроники: при включении устройства проверяют, не идёт ли дым.
 *
 * Цель Smoke-теста:
 * - Проверить, что API вообще работает и доступно
 * - Убедиться, что базовый запрос возвращает успешный ответ
 * - Это первый тест, который должен пройти перед запуском остальных тестов
 *
 * Если Smoke-тест падает, значит что-то критически сломано,
 * и запускать остальные тесты бессмысленно.
 */
@DisplayName("Smoke Tests") // Аннотация задаёт красивое название для отчёта о тестах
public class SmokeTest extends BaseApiTest { // Наследуемся от базового класса с общими настройками

    /**
     * ТЕСТ: Проверка доступности API
     *
     * Что проверяет этот тест:
     * 1. API-сервер запущен и принимает запросы
     * 2. Эндпоинт получения всех заметок работает
     * 3. Сервер возвращает статус код 200 (успешный запрос)
     * 4. В ответе приходит поле "success" со значением true
     *
     * Зачем аннотация @Test:
     * Она помечает этот метод как тестовый. JUnit находит все методы с @Test
     * и автоматически запускает их при выполнении тестов.
     *
     * Зачем аннотация @DisplayName:
     * Задаёт человекочитаемое название теста для отчётов.
     * Вместо технического имени метода apiShouldBeAvailable() в отчёте
     * будет написано "API should be available and respond with 200 OK".
     */
    @Test // Помечаем метод как тест - JUnit автоматически запустит его
    @DisplayName("API should be available and respond with 200 OK") // Красивое название для отчёта
    public void apiShouldBeAvailable() {

        // ШАГ 1: Отправляем GET-запрос к API для получения всех заметок
        // NotesClient.getAllNotesResponse() - это наш вспомогательный метод,
        // который делает HTTP-запрос к серверу и возвращает ответ
        Response response = NotesClient.getAllNotesResponse();

        // ШАГ 2: Проверяем ответ от сервера
        // response.then() - начинаем цепочку проверок (assertions) для ответа
        response.then()
                // Проверка 1: Код ответа должен быть 200 (OK - успешный запрос)
                // Если код будет 404, 500 или любой другой - тест упадёт
                .statusCode(200)

                // Проверка 2: В JSON-ответе должно быть поле "success" со значением true
                // equalTo(true) - это Hamcrest matcher, который проверяет точное совпадение
                // Hamcrest - библиотека для удобных проверок, делает код более читаемым
                .body("success", equalTo(true));

        // Если обе проверки прошли успешно - тест пройден (зелёный)
        // Если хотя бы одна проверка провалилась - тест упал (красный)
    }
}
